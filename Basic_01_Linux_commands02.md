# AI 项目的 Linux 命令基础 (下篇)

本篇是Linux命令基础的下篇。在今天的文章里，我通过一个数据分析的实例，为大家演示一些Linux命令行下可以帮助数据分析的经典命令。今天的示例一共有两个，分别是著名的机器学习 iris 数据集，XXX。

##  iris 数据集

今天第一个示例就是 iris 数据集。该数据集里一共有 150 条记录，五个字段 。字段含义分别是花萼长度，花萼宽度，花瓣长度，花瓣宽度和鸢尾花类别（Setosa，Versicolour，Virginica ）

### 数据获取

数据从UCI 数据集上直接下载，使用命令`wget`：
```
cd /tmp
wget http://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data
```

`wget`是Linux下最常用的下载数据的命令之一， 其通常用法是：
```
 wget -c  -t 0  xxxxx 
```
其中，`-c`表示断点续传，`-t 0`表示无限重试，在Linux下还有`curl`命令同样也可以下载数据。
> 无论是`wget`还是`curl`都只是单线程，我们可以安装其他更快的命令，比如`aria2c`或`axel`命令，都是默认支持断点续传，并能多线程下载的命令。我们可以用`apt`进行安装这些命令。但在实际中，我们看到的很多网站数据很难直接得到下载地址，一般都是通过专门的爬虫去爬取数据。**关于这部分内容，读者们可以参考学习AI派公众号的爬虫专栏系列文章。**

### 数据显示

- 检查数据

获取数据后，第一步是检查数据，简单说是显示数据里的内容。我们这里介绍这些命令主要是处理文本类型的数据，所以显示数据就是打印文本文件。读者很容易想到用`cat`打印，通过该命令能打印一个csv文件里的全部信息：
```
cat data.csv
```
另外，`cat`还有拼接文件的功能，可以用`cat`快速实现两个csv的拼接:
```
cat data1.csv data2.csv > data_all.csv
```
或者是csv数据的添加：
```
cat newdata.csv >>  data_all.csv
```

但是，如果文件行数很多，`cat`会导致刷屏。这时，**`cat`结果更多是作为管道符的一个输入，传递给后续命令进行筛选或处理，**而不是直接显示出来。如果真的想检索所有数据，Linux有一个`less`命令，可以实现快捷的交互式数据检查：
```
less -S iris.data
```
这里的`less`会显示一个交互式的可操作文本界面。内容是文件的所有内容，我们使用键盘上的方向键可以上下观察，发现该数据是一个**没有表头**的逗号分隔的数据表格文件。注意`-S`参数，对数据分析很有用。**该参数保证数据文件的每行内容不会随终端窗口的宽度限制而换行**，让我们不会混淆数据行的位置。
> 在大数据量的初步检查时，`less`更能体现出其作用。因为`less`不会将所有数据一次性都读入内存；此外，在`less`返回的操作界面中，还可以直接使用vim的方向操作键位。比如`ijkl`的四方向操作，以及`shift+G` 和 `gg` 的快捷操作，如果有不知道作用的同学可以亲自试验一下。**在Linux中，很多命令的结果操作，都支持vim键位。**从中我们也可以感受到，在Linux或Unix中，这些小的技术点都是互相联系浑然一体，而不是像Windows那样，大部分都是孤立并很容易废弃。

### 数据筛选

- 筛选行

数据筛选操作中，最常见的是查看前几条记录。假设数据下载位置就是当前目录，可以用命令`head`查看数据中前5条记录:
```
head -n 5 iris.data
```
返回结果：
```
5.1,3.5,1.4,0.2,Iris-setosa
4.9,3.0,1.4,0.2,Iris-setosa
4.7,3.2,1.3,0.2,Iris-setosa
4.6,3.1,1.5,0.2,Iris-setosa
5.0,3.6,1.4,0.2,Iris-setosa
```
也可以查看数据中最后5条记录：
```
tail -n 5 iris.data
```
返回结果：
```
6.3,2.5,5.0,1.9,Iris-virginica
6.5,3.0,5.2,2.0,Iris-virginica
6.2,3.4,5.4,2.3,Iris-virginica
5.9,3.0,5.1,1.8,Iris-virginica
```
> 熟悉Python或R的同学们，可能会觉得对这两条命令觉得眼熟，因为pandas和R里都有`head`和`tail`函数，起到的作用也是一样。**Python和R还有许许多多与Linux保持一致的细节（比如路径分隔符，注释），如果你只用或只熟悉Windows是很难了解这些内容的。

我们想只显示特定的一行，比如显示第5行记录：
```
sed -n 5p iris.data 
```
返回结果：
```
5.0,3.6,1.4,0.2,Iris-setosa
```
如果，我们想显示从A行到第B行的数据，比如从第1行到第3行数据：
```
sed -n 1,3p iris.data
```
返回结果为
```
5.1,3.5,1.4,0.2,Iris-setosa
4.9,3.0,1.4,0.2,Iris-setosa
4.7,3.2,1.3,0.2,Iris-setosa
```
通过`sed`，很容易实现`head`相同的效果。另外，`sed`可以显示多个指定行，比如显示前3行数据还可以用下面的命令：
```
sed -n -e 1p -e 2p -e 3p  iris.data
```
我们可以发现，这里实际是显示了第1行，第2行和第3行数据。

在数据分析中，我们经常需要对数据进行随机打乱顺序的操作。并且可能需要随机取出几条数据，这时可利用`shuf`命令完成。比如，我们想用Linux命令直接从数据中随机抽取3行记录：
```
shuf -n 3 iris.data
```
返回的记录为（**因为是随机，每次都不同**）：
```
6.4,2.8,5.6,2.1,Iris-virginica
5.0,3.5,1.3,0.3,Iris-setosa
4.6,3.1,1.5,0.2,Iris-setosa
```

- 筛选列

Linux的`cut`命令，原本是用于文本分割。我们这里灵活运用，将`cut`用于筛选显示csv中第几列的数据。例如，用`cut`命令显示`iris.data`的第5列类型：
```
cut -d ',' -f 5 iris.data
```
命令返回了类型。
>这里灵活运用了逗号分隔符。逗号分隔符常用于csv中。如果我们拿到一个数据是csv文件，或文件是用逗号分割的文本格式，我们就可以直接使用这条命令查看某列信息，节省了很多调用Python或R的时间。

由于上面的`cut`是全部打印了所有行，命令行被刷屏了。我们结合上一篇文章所讲的管道，和本篇文章前面所介绍的`head`组合使用：
```
cut -d ',' -f 5 iris.data | head -n 3
```
命令则只返回了我们想要的前3行第5列：
```
Iris-setosa
Iris-setosa
Iris-setosa
```

- 数据转换

我们发现，下载的数据和通常看到的csv不同，第一行是数据，不是表头。直接操作这样的数据，我们需要记忆每个字段的索引位置。我们也可以通过拼接操作，为数据增加一行表头。假设我们知道字段名分别是`sepal_length`,`sepal_width`,`petal_length`,`petal_width`和`species`，可以利用`cat`将表头和数据拼接起来：
```
echo "sepal_length,sepal_width,petal_length,petal_width,species" | cat -  iris.data  >  iris.csv
```
这里的`cat -` 部分是把管道符前面的打印内容和后面的`iris.data`进行拼接，然后利用重定向符`>`输出到文件`iris..csv`。




### 文件操作

- 移动或重命名文件
使用`mv`命令：
```
mv file1 file2 dir  # 将file1和file2 移动到dir下
mv dir1 dir2 # 如果dir2不存在，则表示目录重命名
mv file1 file2 # file2存在时会覆盖file2；否则，会重命名file1为file2
```
- 删除文件或文件夹
Linux下的命令是`rm`，**特别注意大部分情况无法撤销`rm`的删除**。传说中的破坏力极大的命令：
```
rm -rf xxxx
```
上述表示强制删除xxx和xxx下的所有文件夹和子目录，生产环境里面**用不好就等于删库跑路**。
- 创建文件夹
命令是`mkdir`，生产中常用到：
```
mkdir -p dir1/dir2/dir3
```
参数`-p`的优点是，在`dir1`，`dir2`不存在时，命令可以直接创建这些目录，而不需要挨个创建。

### 数据（文件）的简单操作



- 搜索关键词所在行

如果想查找`data.csv`中特定值在第几行，可以用：
```
grep -rn data.csv -e "keyword"
```
结果会返回`data.csv`含有`keyword`的每一行。上面的`data.csv`也可以换成通配符，比如`*.csv`,实现多文件的内容搜索。

> 我们可以使用更强大的文本处理命令`awk`来完成更多的文本处理操作。当然`awk`相对也更复杂一些，几乎可以看成是一个独立的编程语言。

- 统计数据
Linux中可以使用`wc`命令统计csv中的数据记录数：
```
wc -l data.csv
```
其中，`-l`表示统计的行数。我们可以发挥想象，结合管道符组合更多的命令，实现更复杂的统计逻辑。
> 🙋‍♂️如果想统计数据csv中，含有某关键词的数据记录数有多少，该怎么实现?

## 参考资源

- [命令行中的数据科学](https://www.datascienceatthecommandline.com)
- [鳥哥的 Linux 私房菜](http://linux.vbird.org/) 